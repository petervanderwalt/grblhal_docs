"use strict";(self.webpackChunkgrblhal=self.webpackChunkgrblhal||[]).push([[709],{3466:(e,t,l)=>{l.r(t),l.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>x});const s=JSON.parse('{"id":"Advanced-Topics/macros-and-expressions","title":"Macros, Expressions & Flow Control","description":"Advanced G-code programming with variables, math functions, and logic control.","source":"@site/docs/06-Advanced-Topics/macros-and-expressions.md","sourceDirName":"06-Advanced-Topics","slug":"/Advanced-Topics/macros-and-expressions","permalink":"/grblhal_docs/Advanced-Topics/macros-and-expressions","draft":false,"unlisted":false,"editUrl":"https://github.com/PETERVANDERWALT/grblhal_docs/tree/main/docs/06-Advanced-Topics/macros-and-expressions.md","tags":[],"version":"current","frontMatter":{"title":"Macros, Expressions & Flow Control","description":"Advanced G-code programming with variables, math functions, and logic control."},"sidebar":"docsSidebar","previous":{"title":"VFD Spindle Setup","permalink":"/grblhal_docs/Guides/vfd-spindle-setup"},"next":{"title":"Networking & Connectivity","permalink":"/grblhal_docs/Advanced-Topics/networking"}}');var n=l(4848),r=l(8453);const d={title:"Macros, Expressions & Flow Control",description:"Advanced G-code programming with variables, math functions, and logic control."},i="Macros, Expressions & Flow Control",c={},x=[{value:"1. Expressions &amp; Math",id:"1-expressions--math",level:2},{value:"Operators &amp; Precedence",id:"operators--precedence",level:3},{value:"Functions",id:"functions",level:3},{value:"2. Parameters (Variables)",id:"2-parameters-variables",level:2},{value:"Numbered Parameters",id:"numbered-parameters",level:3},{value:"Named Parameters",id:"named-parameters",level:3},{value:"System Parameters Reference",id:"system-parameters-reference",level:3},{value:"3. Flow Control (O-Codes)",id:"3-flow-control-o-codes",level:2},{value:"<code>IF</code> / <code>ELSE</code> / <code>ENDIF</code>",id:"if--else--endif",level:3},{value:"<code>WHILE</code> Loop",id:"while-loop",level:3},{value:"<code>DO</code> / <code>WHILE</code>",id:"do--while",level:3},{value:"<code>SUB</code> / <code>ENDSUB</code> / <code>CALL</code> / <code>RETURN</code>",id:"sub--endsub--call--return",level:3},{value:"4. Automatic Tool Change (ATC) Macros",id:"4-automatic-tool-change-atc-macros",level:2},{value:"Enabling M6 Remap",id:"enabling-m6-remap",level:3},{value:"Example <code>tc.macro</code> Structure",id:"example-tcmacro-structure",level:3},{value:"5. Advanced G65 Macro Calls",id:"5-advanced-g65-macro-calls",level:2},{value:"6. Modal Macros (G66 / G67)",id:"6-modal-macros-g66--g67",level:2}];function o(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"macros-expressions--flow-control",children:"Macros, Expressions & Flow Control"})}),"\n",(0,n.jsxs)(t.p,{children:["grblHAL supports advanced G-code features allowing for ",(0,n.jsx)(t.strong,{children:"parametric programming"}),", ",(0,n.jsx)(t.strong,{children:"conditional logic"}),", and ",(0,n.jsx)(t.strong,{children:"math expressions"}),". This brings capabilities similar to LinuxCNC's O-codes and RS274NGC standards to your microcontroller."]}),"\n",(0,n.jsx)(t.h2,{id:"1-expressions--math",children:"1. Expressions & Math"}),"\n",(0,n.jsxs)(t.p,{children:["You can use math expressions anywhere a numeric value is expected by enclosing them in ",(0,n.jsx)(t.code,{children:"[]"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"operators--precedence",children:"Operators & Precedence"}),"\n",(0,n.jsx)(t.p,{children:"Expressions are evaluated based on standard precedence rules:"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Priority"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Operators"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"1 (Highest)"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"**"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Exponentiation (Power)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"2"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"*"}),", ",(0,n.jsx)(t.code,{children:"/"}),", ",(0,n.jsx)(t.code,{children:"MOD"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Multiplication, Division, Modulo"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"3"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"+"}),", ",(0,n.jsx)(t.code,{children:"-"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Addition, Subtraction"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"4"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"EQ"}),", ",(0,n.jsx)(t.code,{children:"NE"}),", ",(0,n.jsx)(t.code,{children:"GT"}),", ",(0,n.jsx)(t.code,{children:"GE"}),", ",(0,n.jsx)(t.code,{children:"LT"}),", ",(0,n.jsx)(t.code,{children:"LE"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Comparison (Equal, Not Equal, Greater Than, etc.)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"5 (Lowest)"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"AND"}),", ",(0,n.jsx)(t.code,{children:"OR"}),", ",(0,n.jsx)(t.code,{children:"XOR"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Bitwise Logic"})]})]})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Examples:"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"[1 + 2 * 3]"})," evaluates to ",(0,n.jsx)(t.code,{children:"7"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"[[1 + 2] * 3]"})," evaluates to ",(0,n.jsx)(t.code,{children:"9"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"[#<_x> GT 100]"})," returns ",(0,n.jsx)(t.code,{children:"1"})," (true) or ",(0,n.jsx)(t.code,{children:"0"})," (false)."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"functions",children:"Functions"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Function"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Example"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"SQRT[n]"})})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Square Root"}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"G1 X[SQRT[100]]"})," (= X10)"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsxs)(t.strong,{children:[(0,n.jsx)(t.code,{children:"SIN[n]"}),", ",(0,n.jsx)(t.code,{children:"COS[n]"}),", ",(0,n.jsx)(t.code,{children:"TAN[n]"})]})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Trigonometry (Degrees)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"G1 Y[SIN[45]*10]"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsxs)(t.strong,{children:[(0,n.jsx)(t.code,{children:"ASIN"}),", ",(0,n.jsx)(t.code,{children:"ACOS"}),", ",(0,n.jsx)(t.code,{children:"ATAN"})]})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Inverse Trig"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"ABS[n]"})})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Absolute Value"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsxs)(t.strong,{children:[(0,n.jsx)(t.code,{children:"ROUND[n]"}),", ",(0,n.jsx)(t.code,{children:"FIX[n]"}),", ",(0,n.jsx)(t.code,{children:"FUP[n]"})]})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Rounding functions"}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"FIX[3.9]"})," (= 3)"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsxs)(t.strong,{children:[(0,n.jsx)(t.code,{children:"LN[n]"}),", ",(0,n.jsx)(t.code,{children:"EXP[n]"})]})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Logarithms"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"PRM[n]"})})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Read grblHAL Setting"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<max_feed> = PRM[110]"})})]})]})]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"2-parameters-variables",children:"2. Parameters (Variables)"}),"\n",(0,n.jsxs)(t.p,{children:["Variables in G-code are called ",(0,n.jsx)(t.strong,{children:"Parameters"}),". They start with ",(0,n.jsx)(t.code,{children:"#"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"numbered-parameters",children:"Numbered Parameters"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"#1 - #30"})}),": Local subroutine arguments (passed via ",(0,n.jsx)(t.code,{children:"G65"}),")."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"#31 - #5000"})}),": Global user variables (non-persistent)."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"#5000+"})}),": Read-only system variables."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"named-parameters",children:"Named Parameters"}),"\n",(0,n.jsxs)(t.p,{children:["You can create readable variable names. System named parameters are read-only and start with ",(0,n.jsx)(t.code,{children:"_"}),"."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"User Variables:"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Syntax:"})," ",(0,n.jsx)(t.code,{children:"#<my_var>"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Assignment:"})," ",(0,n.jsx)(t.code,{children:"#<width> = 100.5"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Usage:"})," ",(0,n.jsx)(t.code,{children:"G1 X#<width>"})]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"system-parameters-reference",children:"System Parameters Reference"}),"\n",(0,n.jsx)(t.p,{children:"These are automatically updated by grblHAL."}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Equivalent #"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"State & Modes"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_metric>"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"1"})," if Metric (G21), ",(0,n.jsx)(t.code,{children:"0"})," if Imperial"]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_absolute>"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"1"})," if Absolute (G90), ",(0,n.jsx)(t.code,{children:"0"})," if Relative"]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_spindle_on>"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"1"})," if Spindle is ON"]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_flood>"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"1"})," if Flood Coolant (M8) ON"]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_tool_offset>"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"1"})," if Tool Offset (G43) Active"]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_homed_state>"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"1"})," if machine is Homed"]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_homed_axes>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Bitmask of Homed Axes (X=1, Y=2...)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"Tools & Pockets"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_current_tool>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Current Tool Number (T)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#5400"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_selected_tool>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Selected Tool Number (Pre-M6)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_current_pocket>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Current Pocket Number"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_selected_pocket>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Selected Pocket Number"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_tool_table_size>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Number of tools in table (0 if disabled)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"Probes"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_probe_state>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"State of Primary Probe Input"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_probe2_state>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"State of Secondary Probe Input"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_toolsetter_state>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"State of Toolsetter Input"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_active_probe>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"ID of currently active probe (-1 if none)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"System Info"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_free_memory>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Free Heap Memory (KBytes)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_call_level>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Current Subroutine Nesting Level"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_value>"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Return value from G65/M98 calls"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#<_value_returned>"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"1"})," if last call returned a value"]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"Coordinates (Current WCS)"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"#<_x>"}),", ",(0,n.jsx)(t.code,{children:"#<_y>"}),", ",(0,n.jsx)(t.code,{children:"#<_z>"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Current WPos X, Y, Z"}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"#5420"}),"..."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"#<_a>"}),", ",(0,n.jsx)(t.code,{children:"#<_b>"}),", ",(0,n.jsx)(t.code,{children:"#<_c>"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Current WPos A, B, C"}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"#5423"}),"..."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"Coordinates (Machine)"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"#<_abs_x>"}),", ",(0,n.jsx)(t.code,{children:"#<_abs_y>"}),"..."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Machine Position (G53)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"Probe Results"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"#5061"})," - ",(0,n.jsx)(t.code,{children:"#5069"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Probe Contact Position (X, Y, Z...)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"#5070"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Probe Success (",(0,n.jsx)(t.code,{children:"1"}),"=Hit, ",(0,n.jsx)(t.code,{children:"0"}),"=Miss)"]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"Work Offsets"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"#5221"})," - ",(0,n.jsx)(t.code,{children:"#5229"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"G54 Offset Vector"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"#5241"})," - ",(0,n.jsx)(t.code,{children:"#5249"})]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"G55 Offset Vector"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"3-flow-control-o-codes",children:"3. Flow Control (O-Codes)"}),"\n",(0,n.jsxs)(t.p,{children:["Logic statements allow your G-code to make decisions. These are essential for ",(0,n.jsx)(t.strong,{children:"Automatic Tool Changers (ATC)"})," and complex probing macro scripts."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Important:"})," Flow control commands (",(0,n.jsx)(t.code,{children:"if"}),", ",(0,n.jsx)(t.code,{children:"while"}),", ",(0,n.jsx)(t.code,{children:"goto"}),") are best supported when running ",(0,n.jsx)(t.strong,{children:"Macro Files"})," from the SD card. Streaming them line-by-line from a sender can be unreliable depending on the sender's implementation."]}),"\n",(0,n.jsxs)(t.h3,{id:"if--else--endif",children:[(0,n.jsx)(t.code,{children:"IF"})," / ",(0,n.jsx)(t.code,{children:"ELSE"})," / ",(0,n.jsx)(t.code,{children:"ENDIF"})]}),"\n",(0,n.jsx)(t.p,{children:"Execute code only if a condition is true."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-gcode",children:"o100 if [#<_metric> EQ 0]\r\n  (print, Error: Please switch to Metric G21)\r\n  M2\r\no100 else\r\n  (print, Metric mode confirmed)\r\no100 endif\n"})}),"\n",(0,n.jsxs)(t.h3,{id:"while-loop",children:[(0,n.jsx)(t.code,{children:"WHILE"})," Loop"]}),"\n",(0,n.jsx)(t.p,{children:"Repeat code while a condition is true."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-gcode",children:"#<count> = 0\r\no101 while [#<count> LT 5]\r\n  G1 X10\r\n  G0 X0\r\n  #<count> = [#<count> + 1]\r\no101 endwhile\n"})}),"\n",(0,n.jsxs)(t.h3,{id:"do--while",children:[(0,n.jsx)(t.code,{children:"DO"})," / ",(0,n.jsx)(t.code,{children:"WHILE"})]}),"\n",(0,n.jsx)(t.p,{children:"Execute at least once, then check condition."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-gcode",children:"o102 do\r\n  (probe logic...)\r\no102 while [#5070 EQ 0] (Repeat until probe hits)\n"})}),"\n",(0,n.jsxs)(t.h3,{id:"sub--endsub--call--return",children:[(0,n.jsx)(t.code,{children:"SUB"})," / ",(0,n.jsx)(t.code,{children:"ENDSUB"})," / ",(0,n.jsx)(t.code,{children:"CALL"})," / ",(0,n.jsx)(t.code,{children:"RETURN"})]}),"\n",(0,n.jsx)(t.p,{children:"Define reusable subroutines."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsxs)(t.strong,{children:["Defining a Sub (e.g., file ",(0,n.jsx)(t.code,{children:"probe_z.macro"}),"):"]})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-gcode",children:"o<probe_z> sub\r\n  G91 G38.2 Z-20 F100\r\n  o103 if [#5070 EQ 0]\r\n     (abort, Probe failed!)\r\n  o103 endif\r\n  G0 Z2\r\no<probe_z> endsub\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Calling a Sub:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-gcode",children:"O<probe_z> call\n"})}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"4-automatic-tool-change-atc-macros",children:"4. Automatic Tool Change (ATC) Macros"}),"\n",(0,n.jsxs)(t.p,{children:["grblHAL allows remaping the ",(0,n.jsx)(t.code,{children:"M6"})," command to a macro file. This works perfectly for DIY tool changers (Rack/Umbrella) or manual changes with auto-touchoff."]}),"\n",(0,n.jsx)(t.h3,{id:"enabling-m6-remap",children:"Enabling M6 Remap"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["Enable ATC support in ",(0,n.jsx)(t.code,{children:"config.h"})," (or Web Builder)."]}),"\n",(0,n.jsxs)(t.li,{children:["Set ",(0,n.jsx)(t.code,{children:"$341"})," (Tool Change Mode) to match your logic."]}),"\n",(0,n.jsxs)(t.li,{children:["When ",(0,n.jsx)(t.code,{children:"M6 T<n>"})," is issued, grblHAL can call a macro named ",(0,n.jsx)(t.code,{children:"tc.macro"})," (or similar) from the SD card."]}),"\n"]}),"\n",(0,n.jsxs)(t.h3,{id:"example-tcmacro-structure",children:["Example ",(0,n.jsx)(t.code,{children:"tc.macro"})," Structure"]}),"\n",(0,n.jsx)(t.p,{children:"This macro handles the physical act of changing the tool."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-gcode",children:"o<tc> sub\r\n  (Save current state)\r\n  M70\r\n\r\n  (Move to Safe Z)\r\n  G53 G0 Z0\r\n\r\n  (Check if tool is already loaded)\r\n  o100 if [#<_current_tool> EQ #<_selected_tool>]\r\n    (print, Tool already loaded)\r\n    M72\r\n    M99\r\n  o100 endif\r\n\r\n  (Move to Old Tool Slot)\r\n  G53 G0 X#<_old_slot_x> Y#<_old_slot_y>\r\n  (Drop Tool Logic...)\r\n  M64 P1 (Open Drawbar)\r\n\r\n  (Move to New Tool Slot)\r\n  G53 G0 X#<_new_slot_x> Y#<_new_slot_y>\r\n  M65 P1 (Close Drawbar)\r\n\r\n  (Restore State)\r\n  M72\r\no<tc> endsub\r\nM99\n"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"RapidChange ATC / Sienci ATC:"}),"\r\nThese systems often use standardized macros (e.g., ",(0,n.jsx)(t.code,{children:"M6"})," calls ",(0,n.jsx)(t.code,{children:"P200.macro"}),") that handle the complex logic of rack management, calibration, and tool offsets."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"5-advanced-g65-macro-calls",children:"5. Advanced G65 Macro Calls"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"G65"})," macro calls allow passing arguments into a subroutine, mapping P/Q/R words to local variables."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Syntax:"})," ",(0,n.jsx)(t.code,{children:"G65 P<program> [L<repeats>] A- B- C-..."})]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Word"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Variable"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Word"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Variable"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"A"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#1"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"I"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#4"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"B"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#2"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"J"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#5"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"C"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#3"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"K"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#6"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"D"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#7"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"S"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#19"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"E"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#8"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"T"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#20"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"F"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#9"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.strong,{children:"X/Y/Z"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"#24/#25/#26"})]})]})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Inbuilt grblHAL Functions:"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"G65 P1 Q<n>"})}),": Read Setting ",(0,n.jsx)(t.code,{children:"<n>"})," value."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"G65 P1 Q<n> S<val>"})}),": Set Setting ",(0,n.jsx)(t.code,{children:"<n>"})," to ",(0,n.jsx)(t.code,{children:"<val>"})," (Build 20251108+)."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"G65 P2 Q<tool> R<axis>"})}),": Read Tool Offset."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"G65 P3 I<n> Q<val>"})}),": Set Parameter ",(0,n.jsx)(t.code,{children:"<n>"})," to ",(0,n.jsx)(t.code,{children:"<val>"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"6-modal-macros-g66--g67",children:"6. Modal Macros (G66 / G67)"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Available from Build 20260125."})}),"\n",(0,n.jsx)(t.p,{children:"Modal macros are called automatically after every motion command."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"G66 P<prog> [L<repeats>] <args...>"})}),": Enable modal macro."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"G67"})}),": Cancel modal macro."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Example:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-gcode",children:"; Drill a hole pattern\r\nG66 P100 Z-5 R2 (Enable Macro 100, pass arguments)\r\nX10 Y10 (Macro 100 runs here)\r\nX20 Y10 (Macro 100 runs here)\r\nG67 (Cancel)\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},8453:(e,t,l)=>{l.d(t,{R:()=>d,x:()=>i});var s=l(6540);const n={},r=s.createContext(n);function d(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);