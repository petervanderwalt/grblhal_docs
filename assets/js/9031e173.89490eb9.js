"use strict";(self.webpackChunkgrblhal=self.webpackChunkgrblhal||[]).push([[992],{5229:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>x,frontMatter:()=>i,metadata:()=>d,toc:()=>o});const d=JSON.parse('{"id":"Advanced-Topics/sender-interface","title":"Sender Developer Guide","description":"Technical reference for developing G-code senders compatible with grblHAL\'s extended protocol.","source":"@site/docs/06-Advanced-Topics/sender-interface.md","sourceDirName":"06-Advanced-Topics","slug":"/Advanced-Topics/sender-interface","permalink":"/grblhal_docs/Advanced-Topics/sender-interface","draft":false,"unlisted":false,"editUrl":"https://github.com/PETERVANDERWALT/grblhal_docs/tree/main/docs/06-Advanced-Topics/sender-interface.md","tags":[],"version":"current","frontMatter":{"title":"Sender Developer Guide","description":"Technical reference for developing G-code senders compatible with grblHAL\'s extended protocol."},"sidebar":"docsSidebar","previous":{"title":"Networking & Connectivity","permalink":"/grblhal_docs/Advanced-Topics/networking"},"next":{"title":"Creating Vendor Profiles","permalink":"/grblhal_docs/Vendors/creating_profiles"}}');var r=s(4848),l=s(8453);const i={title:"Sender Developer Guide",description:"Technical reference for developing G-code senders compatible with grblHAL's extended protocol."},t="Sender Developer Guide",c={},o=[{value:"1. Connection &amp; Startup",id:"1-connection--startup",level:2},{value:"The Problem",id:"the-problem",level:3},{value:"Recommended Sequence",id:"recommended-sequence",level:3},{value:"2. Real-Time Status Reports",id:"2-real-time-status-reports",level:2},{value:"New Fields detailed",id:"new-fields-detailed",level:3},{value:"3. Real-Time Commands",id:"3-real-time-commands",level:2},{value:"4. Enumerations (No More Hardcoded Lists)",id:"4-enumerations-no-more-hardcoded-lists",level:2},{value:"5. Line Termination",id:"5-line-termination",level:2},{value:"6. Push Messages",id:"6-push-messages",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"sender-developer-guide",children:"Sender Developer Guide"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"grblHAL"})," extends the original Grbl v1.1 protocol to support advanced hardware, plugins, and networking. While it remains backward compatible with most legacy senders, fully unlocking its potential requires understanding key differences."]}),"\n",(0,r.jsx)(n.h2,{id:"1-connection--startup",children:"1. Connection & Startup"}),"\n",(0,r.jsxs)(n.p,{children:["Unlike 8-bit Grbl on Arduino Uno, ",(0,r.jsx)(n.strong,{children:"grblHAL controllers do NOT always auto-reset"})," upon serial connection."]}),"\n",(0,r.jsx)(n.h3,{id:"the-problem",children:"The Problem"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Native USB / Network:"})," Hard resetting the MCU (DTR/RTS toggle) often drops the USB/Network link entirely."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MPG / Pendant:"})," A secondary sender (MPG) might be in control at startup."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"recommended-sequence",children:"Recommended Sequence"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Open Port:"})," Connect to the serial/network port."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Wait & Listen (500ms):"})," Do NOT immediately send ",(0,r.jsx)(n.code,{children:"\\r\\n"})," or ",(0,r.jsx)(n.code,{children:"$"}),". Listen for incoming data.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If you see ",(0,r.jsx)(n.code,{children:"|MPG:0"}),", a pendant is yielding control."]}),"\n",(0,r.jsxs)(n.li,{children:["If you see ",(0,r.jsx)(n.code,{children:"Grbl ... ["})," (Welcome Message), proceed."]}),"\n",(0,r.jsxs)(n.li,{children:["If silence/junk, send ",(0,r.jsx)(n.code,{children:"0x18"})," (Ctrl-X / Soft Reset) or ",(0,r.jsx)(n.code,{children:"\\r\\n"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Request Extended Info:"})," Send ",(0,r.jsx)(n.code,{children:"$I+"})," (or ",(0,r.jsx)(n.code,{children:"0x87"})," for full report).","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Parse the response to detect ",(0,r.jsx)(n.code,{children:"[NEWOPT:...]"})," flags like ",(0,r.jsx)(n.code,{children:"ATC"}),", ",(0,r.jsx)(n.code,{children:"ETH"}),", ",(0,r.jsx)(n.code,{children:"SD"}),", ",(0,r.jsx)(n.code,{children:"RT+"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"2-real-time-status-reports",children:"2. Real-Time Status Reports"}),"\n",(0,r.jsxs)(n.p,{children:["The status report format is extended. Senders ",(0,r.jsx)(n.strong,{children:"must"})," parse these robustly by:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Checking for new fields (e.g., ",(0,r.jsx)(n.code,{children:"|Pn:"}),", ",(0,r.jsx)(n.code,{children:"|A:"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Handling variable field order."}),"\n",(0,r.jsx)(n.li,{children:"Ignoring unknown fields."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example Extended Report:"}),"\r\n",(0,r.jsx)(n.code,{children:"<Run|MPos:10.000,20.000,5.000|FS:500,0|Pn:PXYZ|WCS:G54|MPG:0|H:1,7|SD:10.5,/file.nc>"})]}),"\n",(0,r.jsx)(n.h3,{id:"new-fields-detailed",children:"New Fields detailed"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"|Pn:<signals>"})}),": Input pin states. Now supports many more letters:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"P"})," (Probe), ",(0,r.jsx)(n.code,{children:"D"})," (Door), ",(0,r.jsx)(n.code,{children:"H"})," (Hold), ",(0,r.jsx)(n.code,{children:"S"})," (Start), ",(0,r.jsx)(n.code,{children:"R"})," (Reset)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"E"})," (E-Stop), ",(0,r.jsx)(n.code,{children:"O"})," (Probe Disconnected), ",(0,r.jsx)(n.code,{children:"M"}),"/",(0,r.jsx)(n.code,{children:"F"})," (Motor Fault)."]}),"\n",(0,r.jsxs)(n.li,{children:["Limit Switches: ",(0,r.jsx)(n.code,{children:"X"}),", ",(0,r.jsx)(n.code,{children:"Y"}),", ",(0,r.jsx)(n.code,{children:"Z"}),", ",(0,r.jsx)(n.code,{children:"A"}),", ",(0,r.jsx)(n.code,{children:"B"}),", ",(0,r.jsx)(n.code,{children:"C"}),", ",(0,r.jsx)(n.code,{children:"U"}),", ",(0,r.jsx)(n.code,{children:"V"}),", ",(0,r.jsx)(n.code,{children:"W"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"|A:<accessory>"})}),": Accessory states (",(0,r.jsx)(n.code,{children:"S"}),"=CW, ",(0,r.jsx)(n.code,{children:"C"}),"=CCW, ",(0,r.jsx)(n.code,{children:"F"}),"=Flood, ",(0,r.jsx)(n.code,{children:"M"}),"=Mist, ",(0,r.jsx)(n.code,{children:"T"}),"=Tool Change Pending)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"|WCS:<coord>"})}),": Reports active coordinate system (e.g., ",(0,r.jsx)(n.code,{children:"G54"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"|MPG:<0|1>"})}),": ",(0,r.jsx)(n.code,{children:"1"})," = Pendant has control (Sender should verify UI lock). ",(0,r.jsx)(n.code,{children:"0"})," = Pendant released."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"|SD:<status>"})}),": SD Card status (",(0,r.jsx)(n.code,{children:"Mounted"}),", ",(0,r.jsx)(n.code,{children:"PCT"}),", ",(0,r.jsx)(n.code,{children:"Filename"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"|H:<0|1>,<mask>"})}),": Homing status. ",(0,r.jsx)(n.code,{children:"1"}),"=Homed. Mask=Axes homed."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"|TLR:<0|1>"})}),": Tool Length Reference set."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-real-time-commands",children:"3. Real-Time Commands"}),"\n",(0,r.jsxs)(n.p,{children:["Legacy Grbl commands (",(0,r.jsx)(n.code,{children:"?"}),", ",(0,r.jsx)(n.code,{children:"!"}),", ",(0,r.jsx)(n.code,{children:"~"}),", ",(0,r.jsx)(n.code,{children:"0x18"}),') act as expected. grblHAL adds "Top-Bit-Set" alternates to avoid conflicts with string settings (e.g., WiFi passwords containing ',(0,r.jsx)(n.code,{children:"?"}),")."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Standard"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Top-Bit-Set"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"?"})})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"0x80"})})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Status Report Request"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"~"})})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"0x81"})})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Cycle Start"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"!"})})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"0x82"})})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Feed Hold"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"^x"})})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"0x18"})})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Soft Reset"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"New Real-Time Commands:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"0x87"})}),": ",(0,r.jsx)(n.strong,{children:"Full Status Report."})," Returns all fields (even unchanged ones), useful for initial sync."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"0x83"})}),": ",(0,r.jsxs)(n.strong,{children:["Parser State (",(0,r.jsx)(n.code,{children:"$G"}),") Report."]})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"0x89"})}),": Toggle Single Step."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"0x8A"})}),": Toggle Fan (if plugin installed)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"0x8B"})}),": Toggle MPG Mode."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"4-enumerations-no-more-hardcoded-lists",children:"4. Enumerations (No More Hardcoded Lists)"}),"\n",(0,r.jsxs)(n.p,{children:["Senders should ",(0,r.jsx)(n.strong,{children:"dynamically query"})," the controller for supported capabilities instead of hardcoding lists (which go out of date with plugins)."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"$EA"})," (Enumerate Alarms):"]})," Returns ",(0,r.jsx)(n.code,{children:"[ALARM:<code>|<desc>|<details>]"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"$EE"})," (Enumerate Errors):"]})," Returns ",(0,r.jsx)(n.code,{children:"[ERROR:<code>|<desc>|<details>]"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"$ES"})," (Enumerate Settings):"]})," Returns full metadata for every configuration option.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Format: ",(0,r.jsx)(n.code,{children:"[SETTING:<id>|<group>|<name>|<unit>|<type>|<min>|<max>...]"})]}),"\n",(0,r.jsx)(n.li,{children:"Allows building a Settings UI dynamically from the firmware reporting itself."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"5-line-termination",children:"5. Line Termination"}),"\n",(0,r.jsxs)(n.p,{children:["grblHAL accepts ",(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"CR"}),", ",(0,r.jsx)(n.code,{children:"LF"}),", or ",(0,r.jsx)(n.code,{children:"CRLF"})]})," as valid line terminators. It treats ",(0,r.jsx)(n.code,{children:"\\r\\n"})," as a single terminator, unlike legacy Grbl which might double-execute."]}),"\n",(0,r.jsx)(n.h2,{id:"6-push-messages",children:"6. Push Messages"}),"\n",(0,r.jsxs)(n.p,{children:["Enable ",(0,r.jsx)(n.strong,{children:"Push Messages"})," via ",(0,r.jsx)(n.code,{children:"$10"})," settings to receive automatic updates for:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Parser State (",(0,r.jsx)(n.code,{children:"$G"}),"):"]})," Pushed on change."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Probe Results:"})," Pushed on completion."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"G-code Comments:"})," ",(0,r.jsx)(n.code,{children:"(print, ...)"})," comments in G-code are pushed as ",(0,r.jsx)(n.code,{children:"[MSG:...]"}),"."]}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>t});var d=s(6540);const r={},l=d.createContext(r);function i(e){const n=d.useContext(l);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),d.createElement(l.Provider,{value:n},e.children)}}}]);